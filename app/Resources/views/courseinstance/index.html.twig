{% extends 'base.html.twig' %}



{% block body %}
    {% if is_granted('ROLE_USER') %}

    <h1>Moje kurzy</h1>


        {% set isEnrolled = false %}
        {% for courseInstance in courseInstances %}
            {% for enrolledUser in courseInstance.enrolleds %}

                <!-- PRIHLASENY NA KURZY -->
                {% if enrolledUser.userId == app.user and date(courseInstance.timestamp) > date() %}
                    {% set enroll_id = enrolledUser.id %}
                    {% set isEnrolled = true %}
                    <h4>{{ courseInstance.courseType.name }}</h4>
                    <p>{{ courseInstance.courseType.description }}</p>
                    <table>
                        <tr>
                            <th>Dátum</th>
                            <th>Čas</th>
                            <th>Miesto</th>
                            <th>Školiteľ </th>
                            <th>Obsadenosť </th>
                            <th> </th>
                        </tr>
                        <tr>
                            <td>{{ courseInstance.timestamp|date('d.m.Y') }}</td>
                            <td>{{ courseInstance.timestamp|date('H:i') }}</td>
                            <td>{{ courseInstance.place }}</td>
                            <td>{{ courseInstance.supervisor }}</td>
                            <td>{{ courseInstance.enrolleds|length }}/{{ courseInstance.capacity }}</td>
                            {% if  date() < courseInstance.disenrollDate %}
                                <td>
                                    <a href="{{ path('enrolled_show', { 'id':  enroll_id  }) }}" class="btn btn-default">
                                        Odhlásiť sa
                                    </a>
                                </td>
                            {% else %}
                                <td class="text-muted">Ste prihlásený</td>
                            {% endif %}
                        </tr>
                    </table>

                <!-- ABSOLVOVANE KURZY -->
                {% elseif enrolledUser.userId == app.user %}
                    <h4>{{ courseInstance.courseType.name }}</h4>
                    <h5>{{ courseInstance.timestamp|date('d.m.Y H:i') }}</h5>
                    <p>{{ courseInstance.courseType.description }}</p>
                    <p>{{ courseInstance.supervisor }}</p>
                {% endif %}
            {% endfor %}
        {% endfor %}
        {% if not isEnrolled %}
            <p>Momentálne nie ste prihlásený na žiadny kurz.</p>
        {% endif %}
    {% endif %}
{% endblock %}
